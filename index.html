<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Freediving Tracker</title>

<!-- React -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

<style>
:root{
  --deep:#04121f;
  --mid:#06263d;
  --water1:#38bdf8;
  --water2:#0ea5e9;
  --glass:rgba(255,255,255,0.06);
}

*{box-sizing:border-box}
html,body{margin:0;padding:0;background:linear-gradient(180deg,var(--deep),var(--mid));color:#e6f4ff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;}

#root{padding:clamp(16px,4vw,40px);max-width:1100px;margin:auto}

h1{font-weight:600;letter-spacing:1px}

.card{
  background:var(--glass);
  backdrop-filter:blur(20px);
  border-radius:24px;
  padding:clamp(16px,3vw,30px);
  box-shadow:0 20px 60px rgba(0,0,0,.4);
  margin-bottom:24px;
}

.water-btn{
  position:relative;
  border:none;
  padding:14px 28px;
  border-radius:999px;
  font-size:16px;
  color:white;
  background:linear-gradient(145deg,var(--water1),var(--water2));
  box-shadow:inset 0 -4px 8px rgba(0,0,0,.2), 0 10px 30px rgba(14,165,233,.4);
  overflow:hidden;
  transition:all .25s ease;
}

.water-btn:hover{transform:translateY(-2px)}
.water-btn:active{transform:translateY(1px)}

.water-btn::before{
  content:"";
  position:absolute;
  width:120%;
  height:120%;
  top:-10%;left:-10%;
  background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.4), transparent 60%);
  opacity:.4;
}

.water-btn::after{
  content:"";
  position:absolute;
  bottom:-8px;left:20%;
  width:60%;height:20px;
  background:radial-gradient(circle, rgba(255,255,255,.5), transparent 70%);
  filter:blur(6px);
  opacity:.3;
}

.topbar{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}

/* Auth overlay */
#authOverlay{
  position:fixed;inset:0;
  background:rgba(4,18,31,.85);
  backdrop-filter:blur(10px);
  display:flex;align-items:center;justify-content:center;
  z-index:9999;overflow:hidden;
}

.auth-box{
  background:var(--glass);
  padding:40px;
  border-radius:28px;
  text-align:center;
  backdrop-filter:blur(20px);
  box-shadow:0 30px 80px rgba(0,0,0,.5);
}

.fish{
  position:absolute;
  width:80px;height:40px;
  background:linear-gradient(90deg,var(--water1),var(--water2));
  border-radius:60px 60px 60px 0;
  animation:swim 18s linear infinite;
  opacity:.6;
}

.fish::after{
  content:"";
  position:absolute;
  width:8px;height:8px;
  background:#7dd3fc;border-radius:50%;
  right:-5px;top:15px;
  animation:bubble 4s infinite ease-out;
}

@keyframes swim{
  0%{transform:translateX(-100px)}
  100%{transform:translateX(120vw)}
}

@keyframes bubble{
  0%{opacity:0;transform:translateY(0)}
  50%{opacity:1}
  100%{opacity:0;transform:translateY(-40px)}
}

.toast{
  position:fixed;
  bottom:20px;left:50%;
  transform:translateX(-50%);
  background:#0f172a;
  padding:14px 22px;
  border-radius:16px;
  box-shadow:0 10px 40px rgba(0,0,0,.6);
}

@media(max-width:768px){
  .topbar{flex-direction:column;align-items:flex-start}
}

</style>
</head>
<body>

<div id="authOverlay">
  <div class="fish" style="top:20%"></div>
  <div class="fish" style="top:70%;animation-delay:6s"></div>
  <div class="auth-box">
    <h2>–ü—ñ—Ä–Ω–∏ –≥–ª–∏–±—à–µ üåä</h2>
    <p>–£–≤—ñ–π–¥–∏ —á–µ—Ä–µ–∑ Google —â–æ–± —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–Ω—É—Ä–µ–Ω–Ω—è</p>
    <button id="loginBtn" class="water-btn" style="margin-top:20px">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
  </div>
</div>

<div id="root"></div>

<script type="text/babel">

const firebaseConfig={
  apiKey:"AIzaSyBB5vavbOrb5dL890_5dP1IlGtR4O6b4lE",
  authDomain:"freediving-tracker-20da0.firebaseapp.com",
  databaseURL:"https://freediving-tracker-20da0-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"freediving-tracker-20da0",
  storageBucket:"freediving-tracker-20da0.firebasestorage.app",
  messagingSenderId:"760148639764",
  appId:"1:760148639764:web:a00f911f984d9282a5a701"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const auth=firebase.auth();

let uid=null;

function showError(msg){
  const t=document.createElement("div");
  t.className="toast";
  t.innerText=msg||"–û–≥–æ, —Ü–µ —Ç–∏ –∫—É–¥–∏ –Ω–∞—Ç–∏—Å–Ω—É–≤? –ú–æ–∂–µ—à –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏? üòÖ";
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),4000);
}

window.onerror=()=>showError();

const provider=new firebase.auth.GoogleAuthProvider();

document.getElementById("loginBtn").onclick=()=>{
  auth.signInWithPopup(provider).catch(e=>showError(e.message));
};

auth.onAuthStateChanged(user=>{
  if(user){
    uid=user.uid;
    document.getElementById("authOverlay").style.display="none";
  }else{
    document.getElementById("authOverlay").style.display="flex";
  }
});

function App(){
  const [dives,setDives]=React.useState([]);

  React.useEffect(()=>{
    if(!uid) return;
    const ref=db.ref("users/"+uid+"/dives");
    ref.on("value",snap=>{
      setDives(snap.val()?Object.values(snap.val()):[]);
    });
    return ()=>ref.off();
  },[uid]);

  const addDive=()=>{
    if(!uid) return;
    const newDive={
      depth:Math.floor(Math.random()*30)+10,
      time:Math.floor(Math.random()*120)+30,
      date:new Date().toISOString()
    };
    db.ref("users/"+uid+"/dives").push(newDive).catch(()=>showError());
  };

  const logout=()=>auth.signOut();

  return(
    <div>
      <div className="topbar card">
        <h1>Freediving Tracker</h1>
        <button className="water-btn" onClick={logout}>Log Out</button>
      </div>

      <div className="card">
        <button className="water-btn" onClick={addDive}>–î–æ–¥–∞—Ç–∏ –∑–∞–Ω—É—Ä–µ–Ω–Ω—è</button>
      </div>

      <div className="card">
        <h3>–ú–æ—ó –∑–∞–Ω—É—Ä–µ–Ω–Ω—è</h3>
        {dives.length===0 && <p>–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∑–∞–Ω—É—Ä–µ–Ω—å</p>}
        {dives.map((d,i)=>(
          <div key={i} style={{marginBottom:10}}>
            üåä {d.depth}–º | ‚è± {d.time}—Å
          </div>
        ))}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>

</body>
</html>
